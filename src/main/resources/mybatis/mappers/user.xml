<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="user">
	
	<!-- 유저 검색(로그인) -->
	<select id="selectLoginUser" parameterType="UserVo" resultType="UserVo">
		<![CDATA[
			SELECT userNo,
				   userId,
				   userPwd,
			   	   userName
			FROM users
			WHERE userId = #{userId} AND userPwd = #{userPwd}
		]]>
	</select>
	
	<!-- 유저 생성(회원가입) -->
	<insert id="insertUser" parameterType="UserVo">
		<![CDATA[
			INSERT INTO users
				(userNo,
                 userId,
                 userPwd,
                 userName)		
			VALUES
				(seq_user_no.nextval,
                 #{userId}, 
                 #{userPwd}, 
                 #{userName})
		]]>
	</insert>
	
	<!-- 아이디로 유저 검색(아이디 중복 검사) -->
	<select id="selectUserId" parameterType="UserVo" resultType="UserVo">
		<![CDATA[
			SELECT userNo
			FROM users
			WHERE userId = #{userId}
		]]>
	</select>
	
	<!-- 유저 넘버로 유저 검색 -->
	<select id="selectUser" parameterType="int" resultType="UserVo">
		<![CDATA[
			SELECT userNo,
				   userName,
				   userId,
				   userImg
			FROM users
			WHERE userNo = #{userNo}
		]]>
	</select>
	
	<!-- 유저 넘버로 유저가 작성한 게시글 검색 -->
	<select id="selectUserPost" parameterType="int" resultType="PostVo">
		<![CDATA[
			SELECT postNo,
				   postTitle,
				   postContent,
				   postRegDate,
				   postHit,
				   postImg
			FROM posts
			WHERE userNo = #{userNo}
		]]>
	</select>
	
	<!-- 유저 사이의 관계 확인 -->
	<select id="selectUserRelation" parameterType="UserRelationVo" resultType="UserRelationVo">
		<![CDATA[
			SELECT relationNo,
				   relationType
			FROM userRelation
			WHERE relationFrom = #{relationFrom} AND relationTo= #{relationTo}
		]]>
	</select>
	
	<!-- 유저 팔로우 -->
	<insert id="insertUserRelation" parameterType="UserRelationVo">
		<![CDATA[
			INSERT INTO USERRELATION 
				(relationNo, 
				 relationType, 
				 relationFrom, 
				 relationTo, 
				 relationRegDate)
			VALUES
				  (seq_userrelation_no.nextval, 
			       0, 
			       #{relationFrom}, 
			       #{relationTo}, 
			       SYSDATE)
		]]>
	</insert>
	
	<!-- 유저 언팔로우 -->
	<delete id="deleteUserRelation" parameterType="UserRelationVo">
		<![CDATA[
			DELETE FROM userrelation
			WHERE relationTo = #{relationTo}
			AND relationFrom = #{relationFrom} 
		]]>
	</delete>
	
</mapper>
